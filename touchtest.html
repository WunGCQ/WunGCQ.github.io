<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta/>
    <title>课表</title>
    <link rel="stylesheet" href="touchtest.css"/>
    <script src="jq.js"></script>
    <!--<script src="../static/js/lib/jquery.touchy.min.js"></script>-->
    <script src="juicer.js"></script>
</head>
<body class="page" id="page" >

<div class="class-table-container" id="class-table-container">
    <div class="scroll-view">
        <div class="time-col">
            <div class="time-box">
                <div class="time">8:00</div>
                <div class="class-number">1</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">9:00</div>
                <div class="class-number">2</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">10:00</div>
                <div class="class-number">3</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">11:00</div>
                <div class="class-number">4</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">13:30</div>
                <div class="class-number">5</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">14:30</div>
                <div class="class-number">6</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">15:30</div>
                <div class="class-number">7</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">16:30</div>
                <div class="class-number">8</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">18:20</div>
                <div class="class-number">9</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">19:20</div>
                <div class="class-number">10</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">18:20</div>
                <div class="class-number">11</div>
            </div>
        </div>
        <div class="time-col">
            <div class="time-box">
                <div class="time">19:20</div>
                <div class="class-number">12</div>
            </div>
        </div>
    </div>

</div>
<div class="day-row">
    <div class="week-day-wrapper">
        <div class="week-day">
            周一
        </div>
        <div class="date">
            6月22日
        </div>
    </div>
    <div class="week-day-wrapper">
        <div class="week-day">
            周二
        </div>
        <div class="date">
            6月23日
        </div>
    </div>
    <div class="week-day-wrapper">
        <div class="week-day">
            周三
        </div>
        <div class="date">
            6月24日
        </div>
    </div>
    <div class="week-day-wrapper today">
        <div class="week-day">
            周四
        </div>
        <div class="date">
            6月25日
        </div>
    </div>
    <div class="week-day-wrapper">
        <div class="week-day">
            周五
        </div>
        <div class="date">
            6月26日
        </div>
    </div>
    <div class="week-day-wrapper weekend">
        <div class="week-day">
            周六
        </div>
        <div class="date">
            6月27日
        </div>
    </div>
    <div class="week-day-wrapper weekend">
        <div class="week-day">
            周日
        </div>
        <div class="date">
            6月28日
        </div>
    </div>
</div>
<div class="class-wrapper" id="class-wrapper">
    <div class="scroll-view">

    </div>
</div>
<div class="left-top-block"></div>
</body>
<script type="text/html" id="tmp-class">
    <!--
    {@helper teachersString}
        function(arr){
            return arr.join("/");
        }
    {@/helper}
    -->
    {@each classes as item}
    <a class="class-box color-${item.color}"
         data-last="${item.last_time}"
         data-class-num="${item.class_start}"
         data-day-num="${item.day_num}">

        <p class="class-name txt">${item.name}</p>

        <p class="class-position txt">${item.position}</p>

        <p class="class-teacher txt">
            {@each item.teachers as t}
            ${t}/
            {@/each}
        </p>

    </a>
    {@/each}
</script>
<script>
    var fake = {
        "classes": [
            {
                "id":1,
                "name": "我去",
                "position": "教5-101",
                "teachers":["掌权蛋",'啦啊','呵呵'],
                "color": 1,
                "last_time" : 2,
                "class_start": 1,
                "day_num": 1
            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 2,
                "last_time" : 3,
                "class_start": 5,
                "day_num": 1
            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 3,
                "last_time" : 2,
                "class_start": 3,
                "day_num": 2
            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 4,
                "last_time" : 2,
                "class_start": 9,
                "day_num": 3
            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 5,
                "last_time" : 1,
                "class_start": 3,
                "day_num": 5
            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 6,
                "last_time" : 1,
                "class_start": 4,
                "day_num": 5
            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 9,
                "last_time" : 3,
                "class_start": 9,
                "day_num": 6

            },
            {
                "id":1,
                "name": "WRFARDM",
                "position": "J5-101",
                "teachers":["MTMT",'AHA','JUSTIN'],
                "color": 8,
                "last_time" : 3,
                "class_start": 1,
                "day_num": 7

            }

        ]
    };
    (function(data){
        function importClass(data) {
//        var classes = JSON.parse(arg);
            var tmp = $("#tmp-class").html().trim();
            var html = juicer(tmp, data);
            $('.class-wrapper .scroll-view').append(html);
        }
        importClass(data);
        function showNight(){
//            $(".page").hasClass("night") ||
            $(".page").addClass("night");
        }
        function showWeekend(){
//            $(".page").hasClass("weekend")||
            $(".page").addClass("weekend");
        }
        function hideNight(){
//            $(".page").hasClass("night") &&
            $(".page").removeClass("night");
        }
        function hideWeekend(){
//            $(".page").hasClass("weekend") &&
            $(".page").removeClass("weekend");
        }

        var t = 0;
        var touchMoveLock = (function(){
            var lock = false;
            var startTime = null;
            var x= 0,y=0;
            return{
                setLock:function(e){
                     startTime = e.timeStamp;
                     x = e.originalEvent && e.originalEvent.touches[0].clientX ||  event.touches[0].clientX;
                    y = e.originalEvent && e.originalEvent.touches[0].clientY ||  event.touches[0].clientY;
                    //console.log("x: "+x+", y: "+y);
                },
                checkLock:function(e){
                    if(!lock){
                        var now = e.timeStamp;
                        if(now - startTime < 200){
                            return false;
                        }else{
                            lock = true;
                            return lock;
                        }
                    }
                    else{
                        return lock;
                    }

                },
                reset : function(){
                    lock = false;
                    startTime = null;
                },
                touchDirection: function(e){
                    if(lock){
                        var _x = e.originalEvent 
                                &&
                                (e.originalEvent.length>0 && e.originalEvent.touches[0].clientX)
                                ||  (event.touches.length>0 && event.touches[0].clientX);
                        var _y =  e.originalEvent
                                &&
                                (e.originalEvent.length>0 && e.originalEvent.touches[0].clientY)
                                ||  (event.touches.length>0 && event.touches[0].clientY);
                       // console.log("_x: "+_x+", _y: "+_y);
                        var dx = 0,dy = 0;
                        if(_x - x > 20){ dx = 1}
                        else if(x - _x > 50){ dx = -1}
                        if(_y - y > 20){ dy = 1}
                        else if(y - _y > 50){ dy = -1}
                        return{
                            deltaX : dx,
                            deltaY : dy
                        };
                    }else{
                        return false;
                    }
                }
            }
        })();

        $("#page").on('touchstart',function(e){
           touchMoveLock.setLock(e);
            e.preventDefault();
            //console.log(e);

        });
        $("#page").on('touchmove',function(e){

            if(touchMoveLock.checkLock(e)){
                e.preventDefault();
                var d = touchMoveLock.touchDirection(e);
                switch (d.deltaX){
                    case 0:
                        break;
                    case -1:
                        showWeekend();
                        break;
                    case 1:
                        hideWeekend();
                        break;
                }
                switch (d.deltaY){
                    case 0:
                        break;
                    case -1:
                        showNight();
                        break;
                    case 1:
                        hideNight();
                }
                var t = e.target;
            }
        });
        $("#page").on('touchend',function(e){
            var d = touchMoveLock.touchDirection(e);
            if( d!=false ){

            }
            touchMoveLock.reset();
            e.preventDefault();
            //console.log(e);
        });
    })(fake);




</script>

</html>
